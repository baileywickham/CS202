<!doctype html>
<html>
<head>
   <meta charset="utf-8"/>
   <title>Lab 6, CSC/CPE 203</title>
   <link rel="stylesheet" href="../../lib/assignment.css" type="text/css">
</head>

<body>
<div class="container">
  <div class="boxed">

  <div class="header">  <h1>Lab 6, CSC/CPE 203 - collect data</h1></div>

<p>
 <div class="header">
 <h2>Orientation</h2>
 </div>
<p>
For this lab you will implement a program that mimics data analysis
for an e-commerce site.  You will implement a set of classes (largely as
determined by you) to represent the data stored in a log file. You will
then work with the in-memory structures to compute various statistics on 
the collected data.
</p>

<div class="header">
<h2>Objectives</h2>
</div>

<ul>
<li><p>Understand the provided base code that reads data from each line of a file
   into an array of strings</p></li>
<li><p>Write code to process the data into appropriate data structures,
   including writing your own classes and creating hash maps, lists
   and sets as needed.
   </p></li>
<li><p>Write code that operates on the data in order to compute statistics
   about it, including building relations between various items, and
   computing averages, differences, and counting given specific
   items.</p></li>
<li>Understand using a <code>Map</code> to associate an object with
    a given key value, where that object is used to collect data.
</ul>
<div class="header">
<h2>Given Files</h2>
</div>

<p>
The given files include base code to help in the task of analyzing log data.
Your final program will need to read in e-commerce like data from a file and
compute statistics based on the information in the log.  The base code
implements the file reading and some of the parsing, but not the processing of 
the data read.  You will need to complete the processing of the data for this lab, 
including putting the data into appropriate data structures.
You are encouraged to read through the provided code.
</p>

<div class="header">
<h2>Log File</h2>
</div>

<p>
Examine the provided log files.  For example, look at the contents of
<code>small.log</code>. You will find various entries
representing customer use of an imaginary e-commerce site.  Each entry
will appear on a single line in the file and consist of an entry
type tag followed by the corresponding entry attributes.  The
different types of entries and their attributes are as follows.
</p>

<ul>
   <li><p><b><code>START sessionId customerRegion customerIDInRegion</code></b></p></li>
   <li><p><b><code>VIEW sessionId productId price</code></b></p></li>
   <li><p><b><code>BUY sessionId productId price quantity</code></b></p></li>
   <li><p><b><code>END sessionId</code></b></p></li>
</ul>

<p>
Each <code>sessionId</code> is a unique identifier represented as a
<code>String</code>,
each <code>productId</code> is a unique identifier represented as a
<code>String</code>,
each <code>price</code> is an integer number of cents, and
each <code>quantity</code> is an integer.  Both customerRegion and
customerIDInRegion are strings, and the two taken together
uniquely identify a customer.
</p><p>
Note that the same session can end and re-start within the log
file.  If this happens, it will always
be the same session, for the same customer.
</p>

<div class="header">
<h2>Task</h2>
</div>

<p>
Your program will take the name of a log file as a command-line argument.
It must then read the file and create data structures in memory
in order to process the data.  Your program will then operate on the
data in memory, and output the results of computing the statistics discussed
below.
</p>

<p>
You must determine how to represent the entries and which data structures
to use for processing the data.  Look at the provided code, where you will
find several clues.  Though you might be tempted to simplify
the data since not all of it is used in the required analysis, avoid that
temptation.  Define classes, as appropriate, to represent the
entries, giving consideration for cohesion and coupling.  While you're at
it, don't forget what you learned about data structures -- efficiency matters!
</p>

<p>
You should note that within the provided source file there is an example of
such processing and the use of the <code>Session</code> data structure to 
store some of the information.  You will also note that during parsing, the key used to 
look up the <code>Session</code> is not itself a <code>Session</code> object.  It is just
the key, and it is a type that has 
<code>equals()</code> and <code>hashCode()</code> defined for it.  This
strategy is sometimes known as <b>canonicalizing</b> the <code>Session</code> 
objects by their key.  With 
this strategy, there is only ever one, "canonical" instance of <code>Session</code> to
represent each session, even if it has to be looked up more than once.  For that
reason, <code>Session</code> objects can be used as the key in a hash table, even though
<code>Session</code> inherits the default <code>equals()</code> 
and <code>hashCode()</code> implementation from <code>java.lang.Object</code>.
That's because, with one unnique ("canonical") object representing each session, 
object identity and object equivalence are the same thing.

</p><p>
You might consider canonicalizing one or more of the other data types in your code
by their lookup key.
</p>

<p>
Your program is only expected to analyze correctly formatted and
organized log
files.  In particular, for a given <code>sessionId</code>, all <code>VIEW</code>
and <code>BUY</code> entries will come after a <code>START</code> entry and
come before an <code>END</code> entry.  It is possible that
a session may not have ended when the log file was taken, so there might not
be an <code>END</code> entry.  It is also possible
for a session to end and re-start, as described above.
</p>

<div class="header">
<h3>Statistics</h3>
</div>

<p>
Your program must compute the following statistics.
</p>

<ul>
   <li>Print the average number of items viewed by a customer
      during a session where no purchase is made.  In other words, over
      all sessions where a purchase <em>is not</em> made,
      compute the average number of views (VIEW entries). <i>Note that
      viewing the same item more than once should be counted - you are
      computing the average "views," not the average number of items
      viewed.</i>
   <li>For each session associated with a purchase,
      print information about the purchase(s) in that session.  Within 
      each such session, for each productId of a purchased product, print 
      the purchase price (in cents)
      minus the average price of the items viewed during that session.
      Keep in mind that there may be multiple purchases in a given session.
      <i>Note that you should not consider the quantity of the
      purchased item; just compute the difference of the unit price on a
      given product with the average unit price.</i>  This report
      should be sorted by session ID, and within a
      session, the buys should be sorted by product ID.
   <li>For each customer, determine the products that customer purchased,
      if any.  For each product that customer purchased,
      print the number of sessions in which that customer viewed that
      product. 
      <i>Note you are computing the number of sessions in which
      the purchased item was viewed, and not the total number of views of that
      item.</i>  In the report,
      sort the customers by customer region, then by the ID code within
      the region.  Within each customer, sort the products by ID.
</ul>

<p>
All of the floating-point values must be formatted to two decimal
places, using <code>LogAnalyzer.format(double)</code>.  Notice the
sample output below, where you see "3.00" and "125.00," and not "3" and
"5."  Your lab
will be graded by program that compares its output to the expected
output.  If you do not format your numbers in the expected way, many
of the grading metrics will fail, resulting in a low lab score.
<p>
The output of your program when run on the provided <code>small.log</code>
file should be <b>exactly</b> as follows.

<blockquote>
<pre>Average Views without Purchase: 3.00

Price Difference for Purchased Product by Session
    session0
        product3 125.00
    session2
        product3 125.00

Number of Views for Purchased Product by Customer
    region1 customer0
        product3 1
    region2 customer0
        product3 2</pre>
</blockquote>
<p>
Note that alphabetical order with numbers can sometimes be
surprising.  "2" comes after "17," because "2" is after "1"
in the "alphabet."  In all cases, you are just being asked to sort
the reports in alphabetical order.
</p>

<h2>How to tackle this lab...</h2>
<p>
This is a longer lab and requires you to solve some data processing
challenges on your own.  You might want to consider these steps.
</p>
<ul>
<li><p>To start, make sure you understand the log file format.</p></li>
<li><p>Consider class designs to store important entries from the log file.</p></li>
<li><p>Look at <code>main()</code> and how the data processing is proceeding.
<code>Main.main()</code> calls <code>LogParser.parse()</code>, which 
calls <code>processLine()</code>, which then processes the entries differently.
You will write two of them.</p></li>
<li><p>Think about the collection data structure you will use to store all the data - you will allocate that data structure in main and then pass it to the relevant methods mentioned above until you get down to the point of actually creating objects and storing them. Get a grasp of the control flow and make sure the general idea of how you are going to store data makes sense - if it does not at this point, stop and talk to your instructor or neighbor.</p></li>
<li><p>Fill in the important data processing steps 
(<code>processViewEntry()</code> and <code>processBuyEntry()</code>)</p></li>
<li><p>Stop here and enable the <code>printOutExample()</code> method by modifying
<code>Constants.java</code> so that it prints out your processed data.  It should 
like the following for <code>small.log</code>,
though the entries might not be in the same order.</p></li>
<blockquote>
<pre>
Customer(region=region2, idInRegion=customer0)
    in Session(id=session3, customer=Customer(region=region2, idInRegion=customer0))
        looked at Product(id=product1)
        looked at Product(id=product1)
        looked at Product(id=product0)
        looked at Product(id=product1)
        looked at Product(id=product3)
    in Session(id=session0, customer=Customer(region=region2, idInRegion=customer0))
        looked at Product(id=product0)
        looked at Product(id=product1)
        looked at Product(id=product3)
        looked at Product(id=product3)
    in Session(id=session1, customer=Customer(region=region2, idInRegion=customer0))
        looked at Product(id=product1)
Customer(region=region1, idInRegion=customer0)
    in Session(id=session2, customer=Customer(region=region1, idInRegion=customer0))
        looked at Product(id=product3)
        looked at Product(id=product2)
        looked at Product(id=product2)
        looked at Product(id=product0)
</pre>
</blockquote>
<li><p>Now you are ready to write the code to compute statistics on your data; take each task one at a time.
</p></li>
<li><p>Next, test to make sure your output matches and you are done! </p></li>
</ul>

<div class="header">
<h2>Submission</h2>
</div>

<p>
Submit your code in <code>turninXXX/lab06</code> to GitHub by midnight on the due date.  
If you'd like to submit the lab one day late with a penalty of 5%, 
add a file called <code>late_5_percent_off.txt</code> to the 
<code>lab06</code> directory.  If you'd like to submit the lab two 
days late with a penalty of 15%, add a file called
<code>late_15_percent_off.txt</code> to the <code>lab06</code>
directory.  Make sure you add and push the late file.
<p>
After your code is working and submitted,
check you submission using the <code>checkgit</code> command on the
unix server.  If the autograder can't compile your lab for a reason that
is caught by <code>checkgit</code>, you will get a zero on the lab.  To
check your submission, on a Unix server type:
<blockquote><pre>checkgit &lt;git-login> 203 lab06</pre></blockquote>
<p>
If it works, you will see the message "** Tests Passed **".  If not,
you will see some kind of error message.  The error message might not tell
you exactly what you need to change, but it should give an indication as
to what is wrong.
</div>
</div>
</div>
</body>
</html>
